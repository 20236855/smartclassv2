# 知识图谱可视化使用指南

## 快速开始

### 1. 启动后端服务

```bash
cd RuoYi-Vue-master
# 确保已配置好数据库和千问 API
mvn clean install
cd ruoyi-admin
mvn spring-boot:run
```

### 2. 启动前端服务

```bash
cd ruoyi-ui
npm install
npm run dev
```

访问：http://localhost:80

### 3. 配置千问 API（可选）

在 `ruoyi-admin/src/main/resources/application.yml` 中添加：

```yaml
qianwen:
  api:
    url: https://api.siliconflow.cn/v1/chat/completions
    key: your-api-key-here
    model: Qwen/QwQ-32B
```

或使用环境变量：
```bash
export QIANWEN_API_URL=https://api.siliconflow.cn/v1/chat/completions
export QIANWEN_API_KEY=your-api-key-here
```

## 使用流程

### 步骤 1：准备题库数据

确保数据库中有题目数据：

```sql
-- 查看现有题目
SELECT id, title, course_id, chapter_id FROM question LIMIT 10;

-- 如果没有数据，可以导入测试数据
source sql/seed_limit_questions_course33_chapter1.sql;
```

### 步骤 2：生成知识图谱

#### 方式一：通过管理页面

1. 登录系统（admin/admin123）
2. 进入"系统管理" -> "知识图谱管理"
3. 点击"为课程生成图谱"按钮
4. 输入课程 ID（例如：33）
5. 等待生成完成（异步任务，约 10-30 秒）

#### 方式二：通过 API

```bash
# 生成课程知识图谱
curl -X POST http://localhost:8080/system/graph/extract/course/33 \
  -H "Authorization: Bearer YOUR_TOKEN"

# 生成章节知识图谱
curl -X POST http://localhost:8080/system/graph/extract/chapter/33/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 步骤 3：查看可视化

1. 在知识图谱管理页面，点击"知识图谱可视化"按钮
2. 选择课程（例如：高等数学）
3. 可选：选择章节（例如：第1章 极限）
4. 点击"加载知识图谱"
5. 查看交互式知识图谱

## 可视化功能说明

### 图谱交互

| 操作 | 说明 |
|------|------|
| 鼠标滚轮 | 缩放图谱 |
| 拖拽空白区域 | 平移图谱 |
| 拖拽节点 | 移动节点位置 |
| 点击节点 | 查看节点详情 |
| 悬停节点 | 高亮相邻节点和关系 |

### 节点说明

- **节点大小**：表示置信度（越大越可信）
- **节点颜色**：
  - 🟢 绿色：高置信度（≥70%）
  - 🟠 橙色：中置信度（40%-70%）
  - 🔴 红色：低置信度（<40%）

### 关系说明

- **蓝色箭头**：prerequisite（前置关系）- A 是 B 的前置知识
- **绿色箭头**：uses（使用关系）- A 使用了 B
- **橙色箭头**：related_method（相关方法）
- **灰色箭头**：similar（相似关系）

## 示例场景

### 场景 1：查看高数极限章节的知识图谱

1. 选择课程：高等数学（ID: 33）
2. 选择章节：第1章 极限（ID: 1）
3. 加载知识图谱
4. 预期看到的知识点：
   - 极限
   - 洛必塔法则
   - 等价无穷小
   - 小角度近似
   - 泰勒展开
   - 夹逼定理

### 场景 2：导出知识图谱图片

1. 加载知识图谱
2. 调整视图到最佳角度
3. 点击"导出图片"按钮
4. 图片自动下载为 PNG 格式

### 场景 3：生成新的知识图谱

1. 在可视化页面选择课程和章节
2. 点击"生成知识图谱"按钮
3. 等待 3-5 秒
4. 自动刷新并显示新生成的图谱

## 常见问题

### Q1: 为什么看不到知识图谱？

**A:** 检查以下几点：
1. 是否已经生成知识图谱？
2. 课程 ID 和章节 ID 是否正确？
3. 数据库中是否有对应的题目数据？
4. 查看浏览器控制台是否有错误信息

### Q2: 知识点抽取不准确怎么办？

**A:** 
1. 检查千问 API 配置是否正确
2. 如果未配置 API，系统会使用本地正则表达式回退方案（准确度较低）
3. 可以手动编辑 `knowledge_point` 和 `kp_relation` 表

### Q3: 如何查看生成的知识点和关系？

**A:** 使用 SQL 查询：

```sql
-- 查看知识点
SELECT * FROM knowledge_point WHERE course_id = 33;

-- 查看知识点关系
SELECT 
    kp1.title AS source,
    kp2.title AS target,
    r.relation_type,
    r.ai_generated
FROM kp_relation r
JOIN knowledge_point kp1 ON r.from_kp_id = kp1.id
JOIN knowledge_point kp2 ON r.to_kp_id = kp2.id
WHERE kp1.course_id = 33;
```

## 技术支持

如有问题，请查看：
- 后端日志：`ruoyi-admin/logs/sys-info.log`
- 前端控制台：浏览器 F12 开发者工具
- 数据库日志：检查 MySQL 慢查询日志

## 下一步

- 尝试为不同课程生成知识图谱
- 对比不同章节的知识点差异
- 基于知识图谱设计个性化学习路径

