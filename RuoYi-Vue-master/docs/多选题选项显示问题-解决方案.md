# 多选题选项显示问题 - 完整解决方案

## 📋 问题描述

在题目练习页面中，多选题看不到选项（复选框）。

---

## ✅ 已完成的修复

### 1. 后端修改

#### **Question.java** - 添加options字段
```java
/** 选项列表（非数据库字段，用于前端展示） */
private String options;

public void setOptions(String options) {
    this.options = options;
}

public String getOptions() {
    return options;
}
```

#### **QuestionMapper.xml** - 添加options映射
```xml
<resultMap type="Question" id="QuestionResult">
    ...
    <result property="options" column="options" />
</resultMap>
```

#### **QuestionMapper.xml** - 修改SQL查询
```xml
<select id="selectQuestionList" parameterType="Question" resultMap="QuestionResult">
    SELECT
        q.id, q.title, q.question_type, q.difficulty, q.correct_answer, q.explanation,
        q.knowledge_point, q.course_id, q.chapter_id, q.created_by, q.create_time,
        q.update_time, q.is_deleted, q.delete_time,
        GROUP_CONCAT(CONCAT(qo.option_label, ':', qo.option_text) 
                     ORDER BY qo.option_label SEPARATOR '||') as options
    FROM question q
    LEFT JOIN question_option qo ON q.id = qo.question_id
    <where>
        <!-- 查询条件 -->
    </where>
    GROUP BY q.id
</select>
```

### 2. 前端修改

#### **courses.vue** - parseOptions方法
```javascript
// 解析选项字符串
parseOptions(optionsStr) {
  if (!optionsStr) return []
  const options = []
  const parts = optionsStr.split('||')
  parts.forEach(part => {
    const [key, value] = part.split(':')
    if (key && value) {
      options.push({ key: key.trim(), value: value.trim() })
    }
  })
  return options
}
```

#### **courses.vue** - 多选题模板
```vue
<!-- 多选题 -->
<div v-if="question.questionType === 'multiple'" class="answer-area">
  <el-checkbox-group v-model="userAnswers[question.id]">
    <el-checkbox
      v-for="option in parseOptions(question.options)"
      :key="option.key"
      :label="option.key"
      class="answer-option"
    >
      <span class="option-key">{{ option.key }}.</span>
      <span class="option-value">{{ option.value }}</span>
    </el-checkbox>
  </el-checkbox-group>
</div>
```

---

## 🔍 验证状态

### ✅ 数据库验证
```sql
SELECT q.id, q.title, q.question_type, 
       GROUP_CONCAT(CONCAT(qo.option_label, ':', qo.option_text) 
                    ORDER BY qo.option_label SEPARATOR '||') as options
FROM question q
LEFT JOIN question_option qo ON q.id = qo.question_id
WHERE q.question_type = 'multiple'
GROUP BY q.id
LIMIT 3;
```

**结果**：✅ 返回正确的options数据
```
id: 3021
title: 以下哪些是HTML5新增的语义化标签？（多选）
options: A:<header>||B:<footer>||C:<nav>||D:<div>
```

### ✅ 编译文件验证
- ✅ `ruoyi-system/target/classes/mapper/system/QuestionMapper.xml` 存在
- ✅ 包含 `GROUP_CONCAT` 查询
- ✅ 包含 `options` 字段映射

### ✅ 前端代码验证
- ✅ `parseOptions` 方法正确
- ✅ 模板使用 `v-for` 渲染选项
- ✅ 使用 `v-model` 绑定答案

---

## 🚀 解决步骤

### **步骤1：重启后端服务**

**在IDEA中**：
1. 停止后端服务（点击红色方块按钮 ⬛）
2. 等待完全停止（几秒钟）
3. 重新启动（点击绿色播放按钮 ▶）
4. 等待看到控制台输出：`Started RuoYiApplication in X.XXX seconds`

**为什么需要重启**：
- Java代码修改后需要重新加载
- MyBatis Mapper XML修改后需要重新加载
- 即使文件已编译，运行中的JVM不会自动重新加载

### **步骤2：清除浏览器缓存**

1. 按 `Ctrl + Shift + Delete`
2. 选择"缓存的图片和文件"
3. 点击"清除数据"

或者直接按 `Ctrl + Shift + R` 强制刷新

### **步骤3：测试功能**

1. 登录系统
2. 点击"题目练习"菜单
3. 选择任意课程（如"前端开发基础"）
4. 找到多选题（题目标题中有"多选"字样）
5. **应该能看到复选框选项**

---

## 🔧 如果还是看不到选项

### **诊断步骤**：

#### 1. 检查API响应
1. 按 `F12` 打开浏览器开发者工具
2. 切换到 **Network** 标签
3. 刷新页面，选择课程
4. 找到 `/system/question/list` 请求
5. 点击查看 **Response**

**期望看到**：
```json
{
  "rows": [
    {
      "id": 3021,
      "title": "以下哪些是HTML5新增的语义化标签？（多选）",
      "questionType": "multiple",
      "options": "A:<header>||B:<footer>||C:<nav>||D:<div>",
      ...
    }
  ]
}
```

**如果`options`字段为null或不存在**：
- 后端服务没有重启
- 需要在IDEA中重新启动后端

#### 2. 检查控制台错误
1. 在开发者工具中切换到 **Console** 标签
2. 查看是否有JavaScript错误
3. 查看是否有Vue警告

#### 3. 检查后端日志
在IDEA的控制台中查看是否有：
- SQL错误
- MyBatis映射错误
- 其他异常

---

## 📊 数据流程

```
数据库 question_option 表
    ↓
QuestionMapper.xml (LEFT JOIN + GROUP_CONCAT)
    ↓
Question.java (options字段)
    ↓
QuestionController (返回JSON)
    ↓
前端API调用 (/system/question/list)
    ↓
courses.vue (parseOptions方法)
    ↓
v-for渲染复选框
```

---

## ✅ 预期结果

多选题应该显示为：

```
第 X 题  [多选题] [中等]

以下哪些是HTML5新增的语义化标签？（多选）

☐ A. <header>
☐ B. <footer>
☐ C. <nav>
☐ D. <div>
```

---

## 🎯 总结

**问题根源**：后端没有关联查询 `question_option` 表

**解决方案**：
1. ✅ 修改QuestionMapper.xml使用LEFT JOIN和GROUP_CONCAT
2. ✅ 添加options字段到Question实体
3. ✅ 前端使用parseOptions解析选项字符串
4. ⚠️ **必须重启后端服务**

**关键点**：修改Mapper XML后，必须重启后端才能生效！

