# è§†é¢‘çŸ¥è¯†ç‚¹æŠ½å–åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

åœ¨åŸæœ‰çš„é¢˜åº“çŸ¥è¯†ç‚¹æŠ½å–åŠŸèƒ½åŸºç¡€ä¸Šï¼Œæ–°å¢äº†**è§†é¢‘å†…å®¹çŸ¥è¯†ç‚¹æŠ½å–**åŠŸèƒ½ã€‚ç°åœ¨ç³»ç»Ÿå¯ä»¥ä»**è§†é¢‘æ ‡é¢˜å’Œæè¿°**ä¸­è‡ªåŠ¨æŠ½å–çŸ¥è¯†ç‚¹ï¼Œä¸é¢˜åº“æŠ½å–çš„çŸ¥è¯†ç‚¹èåˆï¼Œç”Ÿæˆæ›´å…¨é¢çš„çŸ¥è¯†å›¾è°±ã€‚

## ä¸»è¦ç‰¹æ€§

âœ… **å¤šæºèåˆ**ï¼šä»è§†é¢‘å’Œé¢˜åº“ä¸¤ä¸ªæ¥æºæŠ½å–çŸ¥è¯†ç‚¹  
âœ… **è‡ªåŠ¨å»é‡**ï¼šåŸºäºçŸ¥è¯†ç‚¹åç§°è‡ªåŠ¨å»é‡  
âœ… **æ— éœ€æ”¹åŠ¨æ•°æ®åº“**ï¼šä½¿ç”¨ç°æœ‰çš„æ•°æ®åº“è¡¨ç»“æ„  
âœ… **æœ€å°åŒ–ä¿®æ”¹**ï¼šåªåœ¨ç°æœ‰ä»£ç åŸºç¡€ä¸Šæ·»åŠ è§†é¢‘æŠ½å–é€»è¾‘  

## ä¿®æ”¹å†…å®¹

### åç«¯ä¿®æ”¹

#### 1. `KnowledgeGraphServiceImpl.java`

**ä½ç½®**ï¼š`ruoyi-system/src/main/java/com/ruoyi/system/service/impl/KnowledgeGraphServiceImpl.java`

**ä¿®æ”¹ç‚¹1ï¼šæ·»åŠ VideoServiceä¾èµ–æ³¨å…¥**
```java
@Autowired
private com.ruoyi.system.service.IVideoService videoService;
```

**ä¿®æ”¹ç‚¹2ï¼šåœ¨ `generateCourseGraph` æ–¹æ³•ä¸­æ·»åŠ è§†é¢‘æŠ½å–é€»è¾‘**
```java
// ã€æ–°å¢ã€‘è¯»å–è§†é¢‘å¹¶æ‰¹é‡æŠ½å–çŸ¥è¯†ç‚¹å’Œå…³ç³»
com.ruoyi.system.domain.Video videoQuery = new com.ruoyi.system.domain.Video();
videoQuery.setCourseId(courseId);
java.util.List<com.ruoyi.system.domain.Video> videos = videoService.selectVideoList(videoQuery);

if (!videos.isEmpty()) {
    StringBuilder allVideosText = new StringBuilder();
    for (com.ruoyi.system.domain.Video video : videos) {
        // ä½¿ç”¨ä¸é¢˜ç›®ç›¸åŒçš„æ ¼å¼ï¼Œä»¥ä¾¿AIæ›´å¥½åœ°ç†è§£
        allVideosText.append("=== é¢˜ç›® ").append(video.getId()).append(" ===\n");
        if (video.getTitle() != null) allVideosText.append("é¢˜å¹²: ").append(video.getTitle()).append("\n");
        if (video.getDescription() != null) allVideosText.append("è§£æ: ").append(video.getDescription()).append("\n");
        allVideosText.append("\n");
    }

    // ä¸€æ¬¡æ€§è°ƒç”¨AIå¤„ç†æ‰€æœ‰è§†é¢‘
    logger.info("å¼€å§‹æ‰¹é‡å¤„ç† {} ä¸ªè§†é¢‘", videos.size());
    Map<String,Object> videoExtractResult = aiExtractionService.extractKnowledgePointsWithRelations(allVideosText.toString());
    List<Map<String,Object>> videoKps = (List<Map<String,Object>>) videoExtractResult.get("candidates");
    List<Map<String,Object>> videoRels = (List<Map<String,Object>>) videoExtractResult.get("relations");
    if (videoKps != null) allKps.addAll(videoKps);
    if (videoRels != null) allRelations.addAll(videoRels);
    logger.info("ä»è§†é¢‘AIæŠ½å–åˆ° {} ä¸ªçŸ¥è¯†ç‚¹ï¼Œ{} æ¡å…³ç³»",
               videoKps != null ? videoKps.size() : 0, videoRels != null ? videoRels.size() : 0);
}
```

**é‡è¦è¯´æ˜**ï¼šä¸ºäº†è®©AIæ›´å¥½åœ°ç†è§£è§†é¢‘å†…å®¹ï¼Œæˆ‘ä»¬å°†è§†é¢‘æ–‡æœ¬æ ¼å¼åŒ–ä¸ºä¸é¢˜ç›®ç›¸åŒçš„æ ¼å¼ï¼ˆä½¿ç”¨"é¢˜å¹²"å’Œ"è§£æ"æ ‡ç­¾ï¼‰ï¼Œè¿™æ ·å¯ä»¥å¤ç”¨ç°æœ‰çš„AIæç¤ºè¯ï¼Œæé«˜æŠ½å–æˆåŠŸç‡ã€‚

**ä¿®æ”¹ç‚¹3ï¼šåœ¨ `generateChapterGraph` æ–¹æ³•ä¸­æ·»åŠ è§†é¢‘æŠ½å–é€»è¾‘**
- åŒæ ·çš„é€»è¾‘ï¼Œåœ¨ç« èŠ‚å›¾è°±ç”Ÿæˆæ—¶ä¹Ÿä¼šæŠ½å–è§†é¢‘çŸ¥è¯†ç‚¹

## ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡æµ‹è¯•æ•°æ®

ç¡®ä¿æ•°æ®åº“ä¸­æœ‰ä»¥ä¸‹æ•°æ®ï¼š

**è¯¾ç¨‹æ•°æ®**ï¼š
- è‡³å°‘æœ‰1ä¸ªè¯¾ç¨‹

**è§†é¢‘æ•°æ®**ï¼š
```sql
INSERT INTO video (course_id, title, description, status) VALUES
(1, 'Javaé¢å‘å¯¹è±¡ç¼–ç¨‹å…¥é—¨', 'æœ¬è§†é¢‘è®²è§£Javaçš„ç±»ã€å¯¹è±¡ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ ¸å¿ƒæ¦‚å¿µ', 'active'),
(1, 'Javaé›†åˆæ¡†æ¶è¯¦è§£', 'æ·±å…¥è®²è§£ArrayListã€HashMapç­‰å¸¸ç”¨é›†åˆç±»çš„ä½¿ç”¨å’ŒåŸç†', 'active');
```

**é¢˜ç›®æ•°æ®**ï¼š
- ç¡®ä¿è¯¾ç¨‹æœ‰ç›¸å…³çš„é¢˜ç›®æ•°æ®

### 2. ç”ŸæˆçŸ¥è¯†å›¾è°±

#### æ–¹å¼1ï¼šé€šè¿‡å‰ç«¯ç•Œé¢

1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥ï¼šè¯¾ç¨‹ç®¡ç† â†’ è¯¾ç¨‹ç®¡ç† â†’ é€‰æ‹©è¯¾ç¨‹ â†’ è¯¾ç¨‹ç« èŠ‚
3. åˆ‡æ¢åˆ°"çŸ¥è¯†å›¾è°±"æ ‡ç­¾é¡µ
4. ç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®
5. ç­‰å¾…3-5ç§’åç‚¹å‡»"åˆ·æ–°å›¾è°±"

#### æ–¹å¼2ï¼šé€šè¿‡APIè°ƒç”¨

```bash
# ç”Ÿæˆè¯¾ç¨‹æ€»å›¾è°±
curl -X POST http://localhost:8080/system/graph/extract/course/1

# ç”Ÿæˆç« èŠ‚å›¾è°±
curl -X POST http://localhost:8080/system/graph/extract/chapter/1/1
```

### 3. æŸ¥çœ‹ç»“æœ

ç”Ÿæˆå®Œæˆåï¼ŒçŸ¥è¯†å›¾è°±ä¼šåŒ…å«ï¼š
- ä»è§†é¢‘æ ‡é¢˜å’Œæè¿°ä¸­æŠ½å–çš„çŸ¥è¯†ç‚¹
- ä»é¢˜åº“é¢˜ç›®ã€ç­”æ¡ˆã€è§£æä¸­æŠ½å–çš„çŸ¥è¯†ç‚¹
- çŸ¥è¯†ç‚¹ä¹‹é—´çš„å…³ç³»ï¼ˆå‰ç½®ã€ç›¸ä¼¼ã€æ‰©å±•ç­‰ï¼‰

## å·¥ä½œåŸç†

### æ•°æ®æµç¨‹

```
è§†é¢‘æ•°æ® â”€â”€â”
          â”œâ”€â”€> AIæŠ½å–æœåŠ¡ â”€â”€> çŸ¥è¯†ç‚¹å»é‡ â”€â”€> ä¿å­˜åˆ°æ•°æ®åº“ â”€â”€> ç”Ÿæˆå›¾è°±JSON
é¢˜åº“æ•°æ® â”€â”€â”˜
```

### æŠ½å–é€»è¾‘

1. **è§†é¢‘æŠ½å–**ï¼š
   - è¯»å–è¯¾ç¨‹çš„æ‰€æœ‰è§†é¢‘
   - æå–è§†é¢‘çš„æ ‡é¢˜å’Œæè¿°
   - æ‰¹é‡è°ƒç”¨AIæŠ½å–çŸ¥è¯†ç‚¹å’Œå…³ç³»

2. **é¢˜åº“æŠ½å–**ï¼š
   - è¯»å–è¯¾ç¨‹çš„æ‰€æœ‰é¢˜ç›®
   - æå–é¢˜ç›®çš„é¢˜å¹²ã€ç­”æ¡ˆã€è§£æã€é€‰é¡¹
   - æ‰¹é‡è°ƒç”¨AIæŠ½å–çŸ¥è¯†ç‚¹å’Œå…³ç³»

3. **èåˆå»é‡**ï¼š
   - åˆå¹¶è§†é¢‘å’Œé¢˜åº“æŠ½å–çš„çŸ¥è¯†ç‚¹
   - æŒ‰çŸ¥è¯†ç‚¹åç§°å»é‡
   - ä¿ç•™æ‰€æœ‰å…³ç³»

4. **ä¿å­˜ç»“æœ**ï¼š
   - ä¿å­˜çŸ¥è¯†ç‚¹åˆ° `knowledge_point` è¡¨
   - ä¿å­˜å…³ç³»åˆ° `kp_relation` è¡¨
   - ç”Ÿæˆå›¾è°±JSONä¿å­˜åˆ° `knowledge_graph` è¡¨

### AIæŠ½å–æ ¼å¼

AIæœåŠ¡ä¼šè¿”å›ä»¥ä¸‹æ ¼å¼çš„æ•°æ®ï¼š

```json
{
  "candidates": [
    {
      "name": "é¢å‘å¯¹è±¡ç¼–ç¨‹",
      "definition": "ä¸€ç§ç¨‹åºè®¾è®¡èŒƒå¼ï¼Œä»¥å¯¹è±¡ä¸ºä¸­å¿ƒç»„ç»‡ä»£ç ",
      "confidence": 0.9
    }
  ],
  "relations": [
    {
      "source": "ç±»",
      "target": "å¯¹è±¡",
      "type": "prerequisite",
      "confidence": 0.8
    }
  ]
}
```

## æ³¨æ„äº‹é¡¹

### 1. è§†é¢‘æ•°æ®è´¨é‡

- è§†é¢‘çš„**æ ‡é¢˜**å’Œ**æè¿°**è¶Šè¯¦ç»†ï¼ŒæŠ½å–çš„çŸ¥è¯†ç‚¹è¶Šå‡†ç¡®
- å»ºè®®åœ¨è§†é¢‘æè¿°ä¸­åŒ…å«ï¼š
  - è§†é¢‘ä¸»è¦è®²è§£çš„æ¦‚å¿µ
  - æ¶‰åŠçš„çŸ¥è¯†ç‚¹
  - ç›¸å…³çš„æŠ€æœ¯æœ¯è¯­

### 2. ç« èŠ‚çº§å›¾è°±çš„é™åˆ¶

- å½“å‰Videoè¡¨æ²¡æœ‰ `chapter_id` å­—æ®µ
- ç« èŠ‚å›¾è°±ç”Ÿæˆæ—¶ä¼šä½¿ç”¨**æ•´ä¸ªè¯¾ç¨‹çš„è§†é¢‘æ•°æ®**
- å¦‚éœ€æŒ‰ç« èŠ‚è¿‡æ»¤è§†é¢‘ï¼Œéœ€è¦å…ˆæ‰©å±•Videoè¡¨æ·»åŠ  `chapter_id` å­—æ®µ

### 3. æ€§èƒ½è€ƒè™‘

- è§†é¢‘å’Œé¢˜ç›®éƒ½æ˜¯æ‰¹é‡å¤„ç†ï¼Œä¸€æ¬¡æ€§è°ƒç”¨AI
- å¤§é‡æ•°æ®æ—¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
- å»ºè®®åˆ†æ‰¹å¤„ç†æˆ–ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–

1. **æ·»åŠ è§†é¢‘ç« èŠ‚å…³è”**ï¼š
   - åœ¨Videoè¡¨æ·»åŠ  `chapter_id` å­—æ®µ
   - æ”¯æŒæŒ‰ç« èŠ‚è¿‡æ»¤è§†é¢‘

2. **å¢é‡æ›´æ–°**ï¼š
   - æ·»åŠ  `kg_extracted` å­—æ®µæ ‡è®°å·²å¤„ç†çš„è§†é¢‘
   - é¿å…é‡å¤å¤„ç†

### é•¿æœŸä¼˜åŒ–

1. **è§†é¢‘å­—å¹•æŠ½å–**ï¼š
   - é›†æˆè¯­éŸ³è¯†åˆ«æœåŠ¡
   - ä»è§†é¢‘å­—å¹•ä¸­æŠ½å–çŸ¥è¯†ç‚¹

2. **è§†é¢‘å…³é”®å¸§åˆ†æ**ï¼š
   - ä½¿ç”¨OCRè¯†åˆ«PPTå†…å®¹
   - ä»è§†é¢‘ç”»é¢ä¸­æå–çŸ¥è¯†ç‚¹

3. **èµ„æºæ–‡ä»¶è§£æ**ï¼š
   - PDFæ–‡æœ¬æå–
   - Wordæ–‡æ¡£è§£æ
   - PPTå†…å®¹æå–

## æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹1ï¼šåŸºç¡€åŠŸèƒ½æµ‹è¯•

1. åˆ›å»ºè¯¾ç¨‹ï¼Œæ·»åŠ 2-3ä¸ªè§†é¢‘ï¼ˆåŒ…å«è¯¦ç»†æè¿°ï¼‰
2. æ·»åŠ 5-10é“é¢˜ç›®
3. ç”ŸæˆçŸ¥è¯†å›¾è°±
4. éªŒè¯çŸ¥è¯†ç‚¹æ•°é‡ > 0
5. éªŒè¯å›¾è°±åŒ…å«è§†é¢‘å’Œé¢˜åº“çš„çŸ¥è¯†ç‚¹

### æµ‹è¯•ç”¨ä¾‹2ï¼šå»é‡æµ‹è¯•

1. åˆ›å»ºè§†é¢‘ï¼Œæè¿°ä¸­åŒ…å«"é¢å‘å¯¹è±¡ç¼–ç¨‹"
2. åˆ›å»ºé¢˜ç›®ï¼Œè§£æä¸­ä¹ŸåŒ…å«"é¢å‘å¯¹è±¡ç¼–ç¨‹"
3. ç”ŸæˆçŸ¥è¯†å›¾è°±
4. éªŒè¯"é¢å‘å¯¹è±¡ç¼–ç¨‹"åªå‡ºç°ä¸€æ¬¡

### æµ‹è¯•ç”¨ä¾‹3ï¼šç©ºæ•°æ®æµ‹è¯•

1. åˆ›å»ºè¯¾ç¨‹ï¼Œä¸æ·»åŠ è§†é¢‘å’Œé¢˜ç›®
2. å°è¯•ç”ŸæˆçŸ¥è¯†å›¾è°±
3. éªŒè¯ç³»ç»Ÿä¸ä¼šæŠ¥é”™

## å¸¸è§é—®é¢˜

### Q1: ç”Ÿæˆçš„çŸ¥è¯†ç‚¹æ•°é‡ä¸º0ï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. è§†é¢‘å’Œé¢˜ç›®çš„æè¿°æ˜¯å¦è¶³å¤Ÿè¯¦ç»†
2. AIæœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ˆæŸ¥çœ‹åç«¯æ—¥å¿—ï¼‰
3. æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è§†é¢‘å’Œé¢˜ç›®æ•°æ®

### Q2: çŸ¥è¯†ç‚¹é‡å¤ï¼Ÿ

**A:** ç³»ç»Ÿä¼šæŒ‰åç§°å»é‡ï¼Œå¦‚æœå‡ºç°é‡å¤ï¼š
1. æ£€æŸ¥çŸ¥è¯†ç‚¹åç§°æ˜¯å¦å®Œå…¨ç›¸åŒ
2. æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤å»é‡é€»è¾‘æ˜¯å¦æ‰§è¡Œ

### Q3: å¦‚ä½•æŸ¥çœ‹æŠ½å–æ—¥å¿—ï¼Ÿ

**A:** æŸ¥çœ‹åç«¯æ—¥å¿—æ–‡ä»¶ï¼š
```bash
tail -f logs/ruoyi-admin.log | grep "æ‰¹é‡å¤„ç†"
```

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

