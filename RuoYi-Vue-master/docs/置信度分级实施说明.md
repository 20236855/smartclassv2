# 置信度分级实施说明

## 📋 实施内容

已完成**知识点置信度分级**功能，AI会根据证据的充分程度自动评估每个知识点的可信度。

---

## 🎯 置信度分级标准

### 高置信度 (0.7-1.0) ✅

**定义**：原文明确提到该知识点的定义、概念或详细解释

**特征**：
- 有充分的证据支持（如题目解析、视频详细讲解）
- 知识点表述清晰、准确、完整
- 直接从原文中提取，无需推断

**示例**：
```
原文：
"面向对象编程（OOP）是一种程序设计范式，它使用'对象'来设计应用程序。
对象包含数据（属性）和代码（方法）。"

AI抽取：
{
  "title": "面向对象编程",
  "definition": "使用对象来设计应用程序的程序设计范式",
  "evidence": "面向对象编程（OOP）是一种程序设计范式，它使用'对象'来设计应用程序",
  "confidence": 0.9  ← 高置信度
}
```

---

### 中置信度 (0.4-0.7) ⚠️

**定义**：原文提到该知识点，但解释不够详细

**特征**：
- 可以从上下文推断出该知识点，但不是直接表述
- 视频语音识别可能有误，但大致意思清楚
- 需要一定的推理才能确定知识点

**示例**：
```
原文：
"今天讲牛顿第一定律...物体保持静止或匀速直线运动...除非有外力作用..."

AI抽取：
{
  "title": "牛顿第一定律",
  "definition": "物体保持静止或匀速直线运动的定律",
  "evidence": "物体保持静止或匀速直线运动...除非有外力作用",
  "confidence": 0.6  ← 中置信度（解释不完整）
}
```

---

### 低置信度 (0.0-0.4) ❓

**定义**：仅从标题或简短描述推测的知识点

**特征**：
- 证据不足，主要靠推断
- 视频语音识别质量差，内容不确定
- 仅从标题或关键词推测

**示例**：
```
原文：
"【视频标题】Python编程入门
【视频描述】介绍Python基础知识"

AI抽取：
{
  "title": "Python基础",
  "definition": "Python编程语言的基础知识",
  "evidence": "Python编程入门",
  "confidence": 0.3  ← 低置信度（仅从标题推测）
}
```

---

## 🔧 技术实现

### 1. AI提示词修改

**文件**：`ruoyi-system/src/main/java/com/ruoyi/system/service/impl/AiExtractionService.java`

**关键改动**：

```java
// 添加了置信度评估标准
+ "【置信度评估标准】（重要！）\n"
+ "根据以下标准严格评估每个知识点的置信度：\n\n"
+ "★ 高置信度 (0.7-1.0)：\n"
+ "  - 原文明确提到该知识点的定义、概念或详细解释\n"
+ "  - 有充分的证据支持（如题目解析、视频详细讲解）\n"
+ "  - 知识点表述清晰、准确、完整\n\n"
+ "★ 中置信度 (0.4-0.7)：\n"
+ "  - 原文提到该知识点，但解释不够详细\n"
+ "  - 可以从上下文推断出该知识点，但不是直接表述\n"
+ "  - 视频语音识别可能有误，但大致意思清楚\n\n"
+ "★ 低置信度 (0.0-0.4)：\n"
+ "  - 仅从标题或简短描述推测的知识点\n"
+ "  - 证据不足，主要靠推断\n"
+ "  - 视频语音识别质量差，内容不确定\n\n"
```

**添加了示例**：
```java
+ "【置信度示例】\n"
+ "示例1 - 高置信度 (0.9)：...\n"
+ "示例2 - 中置信度 (0.6)：...\n"
+ "示例3 - 低置信度 (0.3)：...\n"
```

**添加了约束**：
```java
+ "4. 置信度必须真实反映证据的充分程度，不要都给高分\n"
+ "5. 对于视频内容，考虑到语音识别可能有误，适当降低置信度\n"
```

### 2. Whisper配置（快速模式）

**文件**：`ruoyi-admin/src/main/resources/application.yml`

```yaml
whisper:
  service:
    url: "http://localhost:5000"
  model: "tiny"  # 使用tiny模型：最快，准确率85%
```

**特点**：
- 模型大小：39MB（vs base的74MB）
- 处理速度：3秒/分钟视频（vs base的10秒）
- 准确率：85%（vs base的95%）
- 内存占用：1GB

---

## 📊 数据结构

### 知识点JSON格式

```json
{
  "candidates": [
    {
      "title": "知识点名称",
      "definition": "知识点定义",
      "evidence": "原文证据",
      "confidence": 0.85  ← 置信度（0.0-1.0）
    }
  ],
  "relations": [
    {
      "source": "知识点A",
      "target": "知识点B",
      "type": "prerequisite",
      "confidence": 0.75,  ← 关系置信度
      "evidence": "推断依据"
    }
  ]
}
```

---

## 💡 使用建议

### 前端展示

**方案1：颜色标记**
```
高置信度 (≥0.7)：🟢 绿色 - 直接展示
中置信度 (0.4-0.7)：🟡 黄色 - 标记"待确认"
低置信度 (<0.4)：⚪ 灰色 - 标记"推测"
```

**方案2：图标标记**
```
高置信度：✅ 已验证
中置信度：⚠️ 待确认
低置信度：❓ 推测
```

**方案3：透明度**
```
高置信度：opacity: 1.0（完全不透明）
中置信度：opacity: 0.7（半透明）
低置信度：opacity: 0.4（很透明）
```

### 知识图谱生成

**核心图谱**（推荐给学生）：
- 仅包含高置信度知识点 (≥0.7)
- 关系也要求高置信度
- 保证质量，避免误导

**完整图谱**（供教师参考）：
- 包含所有置信度的知识点
- 用颜色/大小区分置信度
- 帮助发现潜在知识点

**自适应图谱**：
- 根据用户选择动态调整
- 提供置信度阈值滑块（0.0-1.0）
- 实时过滤显示

---

## 🧪 测试方法

### 方法1：使用测试脚本

```bash
cd whisper-service
python test_confidence.py
```

### 方法2：实际测试

1. 准备三个视频：
   - **高质量**：有详细讲解的教学视频
   - **中质量**：简要说明的视频
   - **低质量**：仅有标题的视频

2. 上传并生成知识图谱

3. 查看返回的知识点置信度

### 方法3：数据库查询

```sql
-- 查看最新生成的知识图谱
SELECT 
  id, title, graph_type,
  JSON_EXTRACT(graph_data, '$.nodes') as nodes
FROM knowledge_graph
WHERE course_id = 33
ORDER BY create_time DESC
LIMIT 1;

-- 统计不同置信度区间的知识点数量
-- （需要在应用层解析JSON）
```

---

## 📈 预期效果

### 题库内容（高质量）

- 高置信度知识点：70-80%
- 中置信度知识点：15-25%
- 低置信度知识点：5-10%

### 视频内容（使用tiny模型）

- 高置信度知识点：40-60%（详细讲解的部分）
- 中置信度知识点：30-40%（简要说明的部分）
- 低置信度知识点：10-20%（仅标题或识别不清的部分）

### 混合内容（题库+视频）

- 高置信度知识点：60-70%
- 中置信度知识点：20-30%
- 低置信度知识点：5-15%

---

## ✅ 优势

1. **更真实**：置信度反映了知识点的可靠程度
2. **更透明**：用户知道哪些知识点是确定的，哪些是推测的
3. **更灵活**：可以根据需求选择不同置信度的知识点
4. **更智能**：AI会考虑语音识别误差，自动调整置信度

---

## 🚀 下一步

1. **测试功能**：
   - 上传不同质量的视频
   - 查看置信度分布是否合理

2. **前端展示**：
   - 根据置信度用不同颜色展示
   - 添加置信度过滤功能

3. **优化调整**：
   - 根据实际效果调整置信度阈值
   - 收集用户反馈

---

**现在置信度分级功能已完全实现！** 🎉

