# 🚀 快速视频转录配置指南（免费+快速版）

## 📋 配置说明

本配置使用 **Whisper tiny 模型**，特点：
- ✅ **完全免费** - 无任何费用
- ✅ **速度最快** - 比base模型快3-5倍
- ✅ **准确率可接受** - 85%左右（稍低但可用）
- ✅ **资源占用少** - 仅需1GB内存

## ⚙️ 当前配置

### 1. Whisper模型配置

**文件**：`ruoyi-admin/src/main/resources/application.yml`

```yaml
whisper:
  service:
    url: "http://localhost:5000"
  model: "tiny"  # 使用tiny模型：最快，准确率85%
```

### 2. AI置信度分级

已在AI提示词中加入**三级置信度约束**：

#### 高置信度 (≥70%)
- 原文明确提到该知识点的定义、概念或详细解释
- 有充分的证据支持（如题目解析、视频详细讲解）
- 知识点表述清晰、准确、完整

#### 中置信度 (40%-70%)
- 原文提到该知识点，但解释不够详细
- 可以从上下文推断出该知识点
- 视频语音识别可能有误，但大致意思清楚

#### 低置信度 (<40%)
- 仅从标题或简短描述推测的知识点
- 证据不足，主要靠推断
- 视频语音识别质量差，内容不确定

---

## 🚀 快速开始（3步）

### 步骤1：安装环境（5分钟）

#### 安装Python 3.8+
```bash
# 下载：https://www.python.org/downloads/
# 安装时勾选 "Add Python to PATH"
python --version
```

#### 安装ffmpeg
```bash
# Windows: https://www.gyan.dev/ffmpeg/builds/
# 下载 ffmpeg-release-essentials.zip
# 解压到 C:\ffmpeg
# 添加 C:\ffmpeg\bin 到系统PATH

ffmpeg -version
```

### 步骤2：启动Whisper服务（1分钟）

```bash
cd whisper-service
start.bat  # Windows用户双击运行
```

**首次运行**会自动下载 tiny 模型（仅39MB，很快）

看到以下信息表示成功：
```
[4/4] 启动Whisper服务...
服务地址: http://localhost:5000
 * Running on http://0.0.0.0:5000
```

### 步骤3：验证服务

访问：http://localhost:5000/health

应该看到：
```json
{
  "status": "ok",
  "service": "whisper-transcription",
  "loaded_models": ["tiny"]
}
```

---

## 📊 性能对比

### Whisper模型对比

| 模型 | 模型大小 | 下载时间 | 处理速度 | 准确率 | 推荐场景 |
|------|---------|---------|---------|--------|---------|
| **tiny** | **39MB** | **10秒** | **最快** | **85%** | **快速处理（当前配置）** |
| base | 74MB | 20秒 | 快 | 95% | 日常使用 |
| small | 244MB | 1分钟 | 中等 | 97% | 高质量需求 |
| medium | 769MB | 3分钟 | 慢 | 98% | 专业场景 |
| large | 1550MB | 5分钟 | 很慢 | 99% | 最高质量 |

### 处理速度对比（1分钟视频）

| 模型 | 处理时间 | 准确率 | 内存占用 |
|------|---------|--------|---------|
| **tiny** | **~3秒** | **85%** | **~1GB** |
| base | ~10秒 | 95% | ~1GB |
| small | ~30秒 | 97% | ~2GB |

**结论**：tiny模型速度是base的3倍，准确率降低10%，但对于教学视频完全可用。

---

## ✅ 使用效果

### 示例1：清晰的教学视频

**视频内容**（语音识别结果）：
```
今天我们来学习Java的面向对象编程。
首先，什么是类？类是对象的模板...
```

**AI抽取结果**：
```json
{
  "candidates": [
    {
      "title": "面向对象编程",
      "definition": "Java的程序设计范式",
      "evidence": "Java的面向对象编程",
      "confidence": 0.75  // 高置信度
    },
    {
      "title": "类",
      "definition": "对象的模板",
      "evidence": "类是对象的模板",
      "confidence": 0.85  // 高置信度
    }
  ]
}
```

### 示例2：音质一般的视频

**视频内容**（语音识别结果，有误）：
```
今天讲解牛顿第一定律...运动的物体...保持运动状态...
```

**AI抽取结果**：
```json
{
  "candidates": [
    {
      "title": "牛顿第一定律",
      "definition": "物体保持运动状态的定律",
      "evidence": "牛顿第一定律...保持运动状态",
      "confidence": 0.55  // 中置信度（识别不完整）
    }
  ]
}
```

### 示例3：仅有标题的视频

**视频内容**：
```
【视频标题】Python入门教程
【视频描述】讲解Python基础
```

**AI抽取结果**：
```json
{
  "candidates": [
    {
      "title": "Python基础",
      "definition": "Python编程语言的基础知识",
      "evidence": "Python入门教程",
      "confidence": 0.25  // 低置信度（仅从标题推测）
    }
  ]
}
```

---

## 🎯 最佳实践

### 1. 视频要求

✅ **推荐**：
- 音质清晰，无明显噪音
- 语速适中，发音清晰
- 单个视频5-15分钟
- 教学内容结构清晰

⚠️ **可接受**（tiny模型也能处理）：
- 有轻微背景音
- 语速稍快
- 偶尔有口误
- 方言口音不太重

❌ **避免**：
- 噪音很大
- 多人同时说话
- 方言很重
- 视频过长（>30分钟）

### 2. 置信度使用建议

**前端展示**：
- 高置信度 (≥0.7)：✅ 绿色标记，直接展示
- 中置信度 (0.4-0.7)：⚠️ 黄色标记，提示"待确认"
- 低置信度 (<0.4)：❓ 灰色标记，提示"推测"

**知识图谱生成**：
- 核心图谱：仅使用高置信度知识点
- 完整图谱：包含所有置信度的知识点
- 关系连接：优先连接高置信度知识点

---

## 🔧 故障排查

### Q1：tiny模型识别准确率太低怎么办？

**方案1**：升级到base模型
```yaml
whisper:
  model: "base"  # 准确率提升到95%，速度降低3倍
```

**方案2**：优化视频质量
- 使用降噪软件处理视频
- 确保录音设备质量好
- 录制时减少背景噪音

### Q2：处理速度还是太慢？

**检查**：
- 是否使用了tiny模型？
- 视频是否太长？建议分段
- 服务器配置是否足够？

**优化**：
```bash
# 如果有NVIDIA显卡，安装GPU加速
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### Q3：置信度都很低怎么办？

**原因**：
- 视频内容太简单（仅标题）
- 语音识别质量差
- 视频没有详细讲解

**解决**：
1. 检查视频是否有清晰的语音
2. 使用测试脚本验证识别效果
3. 考虑手动添加视频描述

---

## 📝 配置文件完整示例

```yaml
# 视频转录配置
video:
  transcription:
    provider: "whisper"  # 使用Whisper
    enabled: true        # 启用转录

# Whisper服务配置
whisper:
  service:
    url: "http://localhost:5000"
  model: "tiny"  # 快速模式：tiny（当前）| 平衡模式：base | 高质量：small
```

---

## 🎉 总结

✅ **当前配置优势**：
- 完全免费
- 速度最快（3秒/分钟视频）
- 资源占用少（1GB内存）
- 准确率可接受（85%）
- 置信度分级清晰

✅ **适用场景**：
- 快速批量处理视频
- 服务器资源有限
- 对准确率要求不是特别高
- 需要快速验证功能

⚠️ **如需更高准确率**：
- 修改配置：`model: "base"` （95%准确率）
- 或使用：`model: "small"` （97%准确率）

---

**现在就开始使用吧！** 🚀

