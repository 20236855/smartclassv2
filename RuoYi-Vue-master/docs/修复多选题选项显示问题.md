# 修复多选题选项显示问题

## 🐛 问题描述

多选题（和单选题）看不到选项，只显示题目内容。

## 🔍 问题原因

选项数据存储在独立的`question_option`表中，但后端查询时没有关联这个表，导致返回的数据中`options`字段为空。

## ✅ 已完成的修复

### 1. 修改了Question.java
添加了`options`字段用于存储拼接后的选项字符串。

### 2. 修改了QuestionMapper.xml
使用`LEFT JOIN`和`GROUP_CONCAT`关联查询选项表：

```xml
<select id="selectQuestionList">
    SELECT 
        q.*,
        GROUP_CONCAT(
            CONCAT(qo.option_label, ':', qo.option_text) 
            ORDER BY qo.option_label 
            SEPARATOR '||'
        ) as options
    FROM question q
    LEFT JOIN question_option qo ON q.id = qo.question_id
    GROUP BY q.id
</select>
```

## 🔄 需要重启后端服务

**重要**：修改了Java代码和Mapper XML后，必须重启后端服务才能生效！

### 方法1：在IDEA中重启（推荐）

1. 找到正在运行的`RuoYiApplication`
2. 点击红色停止按钮 ⬛
3. 等待完全停止
4. 点击绿色运行按钮 ▶
5. 等待看到 "Started RuoYiApplication" 日志

### 方法2：使用命令行重启

#### 步骤1：停止当前进程

```powershell
# 查找Java进程
Get-Process | Where-Object {$_.ProcessName -like "*java*"}

# 停止RuoYi进程（替换为实际的PID）
Stop-Process -Id <PID> -Force
```

#### 步骤2：重新启动

```powershell
# 进入项目目录
cd RuoYi-Vue-master\ruoyi-admin

# 使用Maven启动
mvn spring-boot:run
```

或者使用已编译的jar：
```powershell
java -jar target\ruoyi-admin.jar
```

### 方法3：使用启动脚本

创建启动脚本 `restart_backend.ps1`：

```powershell
# 停止所有RuoYi相关的Java进程
Get-Process | Where-Object {$_.CommandLine -like "*ruoyi*"} | Stop-Process -Force

# 等待进程完全停止
Start-Sleep -Seconds 3

# 启动后端服务
cd RuoYi-Vue-master\ruoyi-admin
Start-Process powershell -ArgumentList "-NoExit", "-Command", "mvn spring-boot:run"
```

## 🧪 验证修复

### 1. 检查后端日志

启动后查看日志，确保没有错误：
```
Started RuoYiApplication in X.XXX seconds
```

### 2. 测试API

使用浏览器或Postman访问：
```
http://localhost:8080/dev-api/system/question/list?courseId=1&pageNum=1&pageSize=5
```

检查返回的JSON中是否有`options`字段：
```json
{
  "rows": [
    {
      "id": 3021,
      "title": "以下哪些是HTML5新增的语义化标签？（多选）",
      "questionType": "multiple",
      "options": "A:<header>||B:<footer>||C:<nav>||D:<div>",
      ...
    }
  ]
}
```

### 3. 测试前端

1. 刷新浏览器（Ctrl + Shift + R）
2. 点击"题目练习"
3. 选择一门课程
4. 查看多选题是否显示选项

## 📊 数据流程

```
数据库
  ↓
question表 + question_option表
  ↓ (LEFT JOIN + GROUP_CONCAT)
Question对象 (options字段: "A:选项1||B:选项2||C:选项3")
  ↓ (JSON序列化)
前端API响应
  ↓ (parseOptions函数)
选项数组 [{key: 'A', value: '选项1'}, {key: 'B', value: '选项2'}, ...]
  ↓
渲染为复选框
```

## 🔍 如果还是看不到选项

### 检查1：确认后端已重启

```powershell
# 查看Java进程启动时间
Get-Process | Where-Object {$_.ProcessName -like "*java*"} | Select-Object Id, StartTime
```

启动时间应该是最近的（重启后的时间）。

### 检查2：查看浏览器控制台

F12 → Network → 找到 `/system/question/list` 请求 → 查看Response

如果`options`字段为`null`或不存在，说明后端还没有加载新代码。

### 检查3：查看后端日志

检查是否有SQL错误或MyBatis映射错误。

### 检查4：手动测试SQL

```sql
SELECT 
    q.id, q.title, q.question_type,
    GROUP_CONCAT(
        CONCAT(qo.option_label, ':', qo.option_text) 
        ORDER BY qo.option_label 
        SEPARATOR '||'
    ) as options
FROM question q
LEFT JOIN question_option qo ON q.id = qo.question_id
WHERE q.id = 3021
GROUP BY q.id;
```

应该返回：
```
+------+------------------------------------------+---------------+------------------------------------------+
| id   | title                                    | question_type | options                                  |
+------+------------------------------------------+---------------+------------------------------------------+
| 3021 | 以下哪些是HTML5新增的语义化标签？（多选）| multiple      | A:<header>||B:<footer>||C:<nav>||D:<div> |
+------+------------------------------------------+---------------+------------------------------------------+
```

## 📝 修改的文件清单

```
RuoYi-Vue-master/
├── ruoyi-system/src/main/java/com/ruoyi/system/domain/
│   └── Question.java                          ✅ 添加options字段
└── ruoyi-system/src/main/resources/mapper/system/
    └── QuestionMapper.xml                     ✅ 修改查询SQL
```

## 🎯 总结

1. ✅ 代码已修改完成
2. ⏳ **需要重启后端服务**
3. ⏳ 重启后刷新浏览器
4. ✅ 应该能看到选项了

## 🚀 快速操作

```powershell
# 1. 停止后端（在IDEA中或使用命令）
# 2. 重新启动后端
# 3. 等待启动完成
# 4. 刷新浏览器（Ctrl + Shift + R）
# 5. 测试多选题
```

